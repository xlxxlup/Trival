# 旅游助手启动指南

## 快速开始

本项目是**前后端分离**架构，提供两种启动方式：

---

## 方式1：开发环境（推荐用于开发和测试）

### 第一步：启动后端API服务

```bash
# 在项目根目录 e:\LLM\Trival
python backend/app.py
```

后端将在 `http://localhost:8000` 启动

### 第二步：启动前端开发服务器

**新开一个终端窗口**，运行：

```bash
# 进入前端目录
cd fronted

# 首次启动需要安装依赖
npm install

# 启动开发服务器
npm run dev
```

前端将在 `http://localhost:5173` 启动（或3000端口）

### 第三步：访问应用

在浏览器中打开：**http://localhost:5173**

---

## 方式2：生产环境（通过一个端口访问）

### 第一步：构建前端

```bash
cd fronted
npm install
npm run build
```

这会在 `fronted/dist` 目录生成构建好的静态文件

### 第二步：启动后端（自动服务前端）

```bash
# 回到项目根目录
cd ..

# 启动后端
python backend/app.py
```

### 第三步：访问应用

在浏览器中打开：**http://localhost:8000**

后端会自动检测并服务构建好的前端文件

---

## 项目架构

```
e:\LLM\Trival/
├── backend/                 # Python后端
│   ├── app.py              # FastAPI应用入口 ⭐
│   ├── api/
│   │   └── trival.py       # API路由（/travel, /resume）
│   ├── agent/
│   │   └── amusement_agent.py  # 智能体工作流
│   ├── formatters/
│   ├── prompts/
│   └── utils/
│
└── fronted/                 # Vue3前端
    ├── src/
    │   ├── components/
    │   │   └── TravelAssistant.vue  # 主界面 ⭐
    │   ├── services/
    │   │   └── api.js      # API调用
    │   └── main.js
    ├── package.json
    └── vite.config.js
```

---

## API端点

- `GET /` - 主页（开发环境返回提示，生产环境返回前端界面）
- `GET /api` - API状态检查
- `POST /travel` - 开始旅游规划
- `POST /resume` - 恢复暂停的规划流程

---

## 测试API（可选）

使用curl或Postman测试后端API：

```bash
# 测试/travel端点
curl -X POST http://localhost:8000/travel \
  -H "Content-Type: application/json" \
  -d '{
    "origin": "郑州",
    "destination": "北京",
    "date": "2025-12-01",
    "people": 2,
    "budget": 5000,
    "preferences": "美食、文化",
    "days": 3
  }'
```

---

## 常见问题

### Q1: 访问8000端口只看到JSON消息？
**A**: 这是正常的！说明后端API正常运行。您需要：
- 开发环境：启动前端开发服务器（见方式1）
- 生产环境：构建前端后访问（见方式2）

### Q2: 前端启动失败？
**A**: 检查Node.js版本（建议16+）：
```bash
node -v
npm -v
```

如果没有安装，从 https://nodejs.org 下载安装

### Q3: 后端启动报错？
**A**: 检查Python依赖：
```bash
pip install -r requirements.txt
```

如果没有requirements.txt，手动安装：
```bash
pip install fastapi uvicorn langchain langgraph pydantic
```

### Q4: 前端无法连接后端？
**A**: 检查 `fronted/src/services/api.js` 中的 `API_BASE` 配置：
```javascript
const API_BASE = import.meta.env?.VITE_API_BASE || 'http://localhost:8000';
```

确保后端在8000端口运行

---

## 环境变量配置

### 后端环境变量

在项目根目录创建 `.env` 文件：

```env
MODEL_NAME=gpt-4
MODEL_API_KEY=your-api-key
MODEL_BASE_URL=https://api.openai.com/v1
```

### 前端环境变量

在 `fronted/` 目录创建 `.env` 文件：

```env
VITE_API_BASE=http://localhost:8000
```

---

## 停止服务

- **后端**: 在终端按 `Ctrl+C`
- **前端**: 在终端按 `Ctrl+C`

---

## 推荐开发流程

1. 启动后端（终端1）: `python backend/app.py`
2. 启动前端（终端2）: `cd fronted && npm run dev`
3. 在浏览器访问: `http://localhost:5173`
4. 修改代码后，前端会自动热重载
5. 修改后端代码后，使用 `uvicorn backend.app:app --reload` 启用热重载

---

## 体验人工介入功能

1. 填写旅游信息（预算设置为6000元以上）
2. 点击"生成攻略"
3. 如果LLM判断需要人工介入，会弹出问题界面
4. 选择或输入您的选择
5. 点击"确认并继续"
6. 流程自动恢复并继续执行
7. 可能会有多轮介入，直到完成

---

## 生产部署建议

1. 构建前端: `cd fronted && npm run build`
2. 使用 gunicorn 或 supervisor 运行后端
3. 配置 Nginx 反向代理
4. 使用 Redis 替换内存session_store
5. 设置合适的 CORS 策略

---

## 技术栈

- **后端**: Python 3.10+, FastAPI, LangChain, LangGraph
- **前端**: Vue 3, Vite, ElementPlus
- **AI**: OpenAI API / 兼容接口
- **工具**: MCP (Model Context Protocol)

---

## 获取帮助

如有问题，请检查：
1. 后端日志（终端输出）
2. 前端控制台（浏览器F12）
3. 网络请求（浏览器F12 → Network）


## git 使用命令

步骤 1：拉取远程最新代码（必做！避免推送冲突）
git pull  # 等价于git fetch + git merge，同步远程最新内容
若拉取时出现「合并冲突」：
打开冲突文件（含 <<<<<<< HEAD/=======/>>>>>>> 分支名 标记），手动修改为正确内容；
标记冲突已解决：git add 冲突文件名；
完成合并提交：git commit -m "解决冲突：合并远程最新代码"。
步骤 2：暂存本地修改
git add .  # 或指定文件，同首次提交
步骤 3：提交到本地仓库
git commit -m "修复XX功能bug：优化登录接口参数校验"
步骤 4：推送到远程仓库
git push  # 已绑定分支（-u），无需重复指定origin main

删除本地 *** 分支
git branch -d ***